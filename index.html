<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de Equa√ß√µes de 1¬∫ Grau</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .jogo-container {
            width: 100%;
            max-width: 800px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .container {
            width: 100%;
        }

        .screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            text-align: center;
            padding: 20px;
        }

        .hidden {
            display: none !important;
        }

        h1, h2 {
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .instructions {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: left;
        }

        .instructions p {
            margin-bottom: 10px;
        }

        .btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            margin: 5px;
        }

        .btn:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .btn-warning {
            background-color: #ff9800;
        }

        .btn-warning:hover {
            background-color: #e68900;
        }

        .btn-success {
            background-color: #2196F3;
        }

        .btn-success:hover {
            background-color: #0b7dda;
        }

        .voltar {
            background-color: #9c27b0;
            margin-top: 20px;
        }

        .voltar:hover {
            background-color: #7b1fa2;
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-bottom: 20px;
        }

        .info-box {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
            min-width: 100px;
        }

        .info-label {
            font-size: 14px;
            opacity: 0.8;
        }

        .info-value {
            font-size: 24px;
            font-weight: bold;
        }

        .timer {
            width: 100%;
            height: 20px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }

        .timer-progress {
            height: 100%;
            width: 100%;
            background-color: #20c997;
            border-radius: 10px;
            transition: width 0.1s linear, background-color 0.3s;
        }

        .game-area {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .fixed-card, .current-card {
            width: 80px;
            height: 100px;
            background: linear-gradient(145deg, #2196F3, #0d47a1);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            font-weight: bold;
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.3);
        }

        .current-card {
            background: linear-gradient(145deg, #FF9800, #e65100);
        }

        .operation {
            font-size: 32px;
            font-weight: bold;
        }

        .deck-container {
            margin-left: 30px;
        }

        .deck {
            width: 80px;
            height: 100px;
            background: linear-gradient(145deg, #4CAF50, #1b5e20);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: transform 0.3s;
        }

        .deck:hover {
            transform: translateY(-5px);
        }

        .options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 500px;
            margin-top: 20px;
        }

        .option {
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .option:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result-title {
            font-size: 36px;
            margin-bottom: 20px;
        }

        .result-stats {
            font-size: 20px;
            margin-bottom: 30px;
        }

        .result-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .lose {
            color: #ff5252;
        }

        .equation-display {
            font-size: 24px;
            margin: 20px 0;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 500px;
        }

        @media (max-width: 600px) {
            .game-area {
                flex-direction: column;
            }
            
            .deck-container {
                margin-left: 0;
                margin-top: 20px;
            }
            
            .options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .result-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="jogo-container">
        <button id="restart-btn" class="btn btn-warning hidden">üîÑ Reiniciar</button>
        
        <div class="container">
            <div class="screen" id="welcome-screen">
                <h1>Bem-vindo ao Jogo de Equa√ß√µes de 1¬∫ Grau</h1>
                <div class="instructions">
                    <p>Resolva as equa√ß√µes antes que o tempo acabe e passe de n√≠vel</p>
                    <p>Ser√° apresentada uma equa√ß√£o de primeiro grau que voc√™ precisa resolver</p>
                    <p>Abaixo, escolha a alternativa correta para o valor de x</p>
                    <p>Pense r√°pido ou o tempo ir√° acabar!</p>
                    <p>Dica: Use opera√ß√µes inversas para isolar a vari√°vel x</p>
                </div>
                <button class="btn" id="start-btn">Come√ßar</button>
            </div>
            
            <div class="screen hidden" id="game-screen">
                <div class="game-info">
                    <div class="info-box">
                        <div class="info-label">Acertos</div>
                        <div class="info-value" id="score">0/20</div>
                    </div>
                    <div class="info-box">
                        <div class="info-label">Tempo</div>
                        <div class="info-value" id="time">30s</div>
                    </div>
                    <div class="info-box">
                        <div class="info-label">N√≠vel</div>
                        <div class="info-value" id="level-display">1</div>
                    </div>
                </div>
                
                <div class="timer">
                    <div class="timer-progress" id="timer-progress"></div>
                </div>
                
                <p class="info-label" id="level-description">N√≠vel 1: Equa√ß√µes b√°sicas</p>
                
                <div class="equation-display" id="equation-display">
                    <!-- A equa√ß√£o ser√° exibida aqui -->
                </div>
                
                <div class="deck-container">
                    <div class="deck" id="deck">
                        <div>20</div>
                    </div>
                </div>
                
                <div class="options" id="options">
                    <!-- As op√ß√µes ser√£o geradas pelo JavaScript -->
                </div>
            </div>

            <button class="voltar btn">Voltar para o menu</button>

            <div class="screen hidden" id="result-screen">
                <h2 class="result-title" id="result-message">Parab√©ns!</h2>
                <p class="result-stats" id="result-stats">Voc√™ acertou 20 de 20 equa√ß√µes!</p>
                <div class="result-buttons">
                    <button class="btn" id="play-again">Jogar Novamente</button>
                    <button class="btn btn-success" id="next-level">Pr√≥ximo N√≠vel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
      // Vari√°veis globais
        let baseTimeLimit = 40;
        let correctAnswer = null;
        let currentLevel = 1;
        let currentEquation = null;
        let gameActive = false;
        let remainingEquations = 20;
        let remainingTime = null;
        let score = 0;
        let timeLimit = 40;
        let timerInterval = null;
        let totalQuestions = 20;
        let errorCount = 0; // Contador de erros consecutivos para penalidade escalonada

        // Elementos do DOM
        let elements = null;
        let levelConfigs = null;

        // Configura√ß√µes de n√≠vel
       function configurarNiveis() {
            levelConfigs = {
                1: { 
                    totalCards: 20, 
                    timeLimit: 40,
                    description: "Equa√ß√µes b√°sicas com adi√ß√£o e subtra√ß√£o" 
                },
                2: { 
                    totalCards: 20, 
                    timeLimit: 30,
                    description: "Coeficiente inteiro multiplicando a vari√°vel" 
                },
                3: { 
                    totalCards: 18, 
                    timeLimit: 55,
                    description: "Combina√ß√£o de adi√ß√£o/subtra√ß√£o com coeficiente" 
                },
                4: { 
                    totalCards: 18, 
                    timeLimit: 65,
                    description: "Vari√°veis em ambos os lados e coeficientes negativos" 
                },
                5: { 
                    totalCards: 16, 
                    timeLimit: 70,
                    description: "Coeficientes fracion√°rios e decimais" 
                },
                6: { 
                    totalCards: 16, 
                    timeLimit: 70,
                    description: "Vari√°veis em ambos os lados com fra√ß√µes" 
                },
                7: { 
                    totalCards: 14, 
                    timeLimit: 80,
                    description: "Uso de par√™nteses para agrupamento" 
                },
                8: { 
                    totalCards: 12, 
                    timeLimit: 100,
                    description: "Combina√ß√£o de fra√ß√µes, decimais e par√™nteses" 
                },
                9: { 
                    totalCards: 10, 
                    timeLimit: 120,
                    description: "Problemas complexos com m√∫ltiplos elementos" 
                },
                10: { 
                    totalCards: 10, 
                    timeLimit: 120,
                    description: "Desafio final - Todas as complexidades" 
                }
            };
        }

        // Fun√ß√£o de inicializa√ß√£o
        function init() {
            configurarNiveis();
            configurarElementosDOM();
            configurarEventListeners();
        }

        function configurarElementosDOM() {
            elements = {
                welcomeScreen: document.getElementById('welcome-screen'),
                gameScreen: document.getElementById('game-screen'),
                resultScreen: document.getElementById('result-screen'),
                scoreElement: document.getElementById('score'),
                timeElement: document.getElementById('time'),
                levelDisplay: document.getElementById('level-display'),
                levelDescription: document.getElementById('level-description'),
                timerProgress: document.getElementById('timer-progress'),
                equationDisplay: document.getElementById('equation-display'),
                deck: document.getElementById('deck'),
                optionsContainer: document.getElementById('options'),
                resultMessage: document.getElementById('result-message'),
                resultStats: document.getElementById('result-stats'),
                nextLevelBtn: document.getElementById('next-level'),
                startBtn: document.getElementById('start-btn'),
                playAgainBtn: document.getElementById('play-again'),
                restartBtn: document.getElementById('restart-btn'),
                voltarBtn: document.querySelector('.voltar')
            };
        }

        function configurarEventListeners() {
            if (elements.startBtn) elements.startBtn.addEventListener('click', startGame);
            if (elements.playAgainBtn) elements.playAgainBtn.addEventListener('click', startGame);
            if (elements.nextLevelBtn) elements.nextLevelBtn.addEventListener('click', nextLevel);
            if (elements.restartBtn) elements.restartBtn.addEventListener('click', reiniciarJogo);
            if (elements.voltarBtn) elements.voltarBtn.addEventListener('click', () => location.reload());
            
            // Event delegation para as op√ß√µes
            if (elements.optionsContainer) {
                elements.optionsContainer.addEventListener('click', (e) => {
                    if (gameActive && e.target.classList.contains('option')) {
                        checkAnswer(parseFloat(e.target.textContent));
                    }
                });
            }

            if (elements.deck) {
                elements.deck.addEventListener('click', () => {
                    if (gameActive) {
                        generateEquation();
                    }
                });
            }

            // Atalhos de teclado para debug
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.altKey) {
                    if (e.key >= '1' && e.key <= '9') {
                        currentLevel = parseInt(e.key);
                        startGame();
                    } else if (e.key === '0') {
                        currentLevel = 10;
                        startGame();
                    }
                }
            });
        }

       function startGame() {
            limparTimer();
            gameActive = true;
            errorCount = 0; // Resetar contador de erros
            
            elements.welcomeScreen.classList.add('hidden');
            elements.resultScreen.classList.add('hidden');
            elements.gameScreen.classList.remove('hidden');
            if (elements.restartBtn) elements.restartBtn.classList.remove('hidden');
            
            const config = levelConfigs[currentLevel];
            totalQuestions = config.totalCards;
            timeLimit = config.timeLimit;
            
            score = 0;
            remainingEquations = totalQuestions;
            elements.scoreElement.textContent = `${score}/${totalQuestions}`;
            elements.deck.querySelector('div').textContent = remainingEquations;
            remainingTime = timeLimit;
            updateTimeDisplay();
            elements.timerProgress.style.width = '100%';
            elements.timerProgress.style.backgroundColor = '#20c997';
            
            updateLevelInfo();
            generateEquation();
            startTimer();
        }

        function reiniciarJogo() {
            if (confirm('Reiniciar o jogo? Seu progresso ser√° perdido.')) {
                limparTimer();
                gameActive = false;
                startGame();
            }
        }

        function limparTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function updateTimeDisplay() {
            elements.timeElement.textContent = `${remainingTime.toFixed(1)}s`;
        }

        function nextLevel() {
            currentLevel = currentLevel < 10 ? currentLevel + 1 : 1;
            startGame();
        }

        function updateLevelInfo() {
            const config = levelConfigs[currentLevel];
            
            elements.levelDisplay.textContent = currentLevel;
            elements.levelDescription.textContent = `N√≠vel ${currentLevel}: ${config.description}`;
        }

        function startTimer() {
            limparTimer();
            
            timerInterval = setInterval(() => {
                if (!gameActive) {
                    limparTimer();
                    return;
                }
                
                remainingTime = Math.max(0, remainingTime - 0.1);
                remainingTime = Math.round(remainingTime * 10) / 10;
                
                updateTimeDisplay();
                
                const percentage = (remainingTime / timeLimit) * 100;
                atualizarTimerVisual(percentage);
                
                if (remainingTime <= 0.1) {
                    limparTimer();
                    endGame();
                }
            }, 100);
        }

        function atualizarTimerVisual(percentage) {
            elements.timerProgress.style.width = `${percentage}%`;
            
            if (percentage <= 25) {
                elements.timerProgress.style.backgroundColor = '#dc3545';
            } else if (percentage <= 50) {
                elements.timerProgress.style.backgroundColor = '#ffc107';
            } else {
                elements.timerProgress.style.backgroundColor = '#20c997';
            }
        }

        function generateEquation() {
            let equation = "";
            let solution = 0;
            
            // Gerar equa√ß√µes baseadas no n√≠vel atual
            switch(currentLevel) {
                case 1:
                    // Mistura do antigo n√≠vel 1 e 2: x + a = b e x - a = b
                    if (Math.random() > 0.5) {
                        // x + a = b
                        let a1 = Math.floor(Math.random() * 15) + 1;
                        let b1 = Math.floor(Math.random() * 15) - 5;
                        equation = `x + ${a1} = ${b1}`;
                        solution = b1 - a1;
                    } else {
                        // x - a = b
                        let a2 = Math.floor(Math.random() * 15) + 1;
                        let b2 = Math.floor(Math.random() * 15) - 5;
                        equation = `x - ${a2} = ${b2}`;
                        solution = b2 + a2;
                    }
                    break;
                    
                case 2:
                    // Antigo n√≠vel 3: a*x = b
                    let a3 = Math.floor(Math.random() * 8) + 2;
                    let b3 = a3 * (Math.floor(Math.random() * 10) - 3);
                    equation = `${a3}x = ${b3}`;
                    solution = b3 / a3;
                    break;
                    
                case 3:
                    // Mistura do antigo n√≠vel 4 e 5
                    if (Math.random() > 0.5) {
                        // a*x + b = c
                        let a4 = Math.floor(Math.random() * 5) + 2;
                        let b4 = Math.floor(Math.random() * 10) + 1;
                        let c4 = a4 * (Math.floor(Math.random() * 10) - 3) + b4;
                        equation = `${a4}x + ${b4} = ${c4}`;
                        solution = (c4 - b4) / a4;
                    } else {
                        // a*x - b = c
                        let a5 = Math.floor(Math.random() * 5) + 2;
                        let b5 = Math.floor(Math.random() * 10) + 1;
                        let c5 = a5 * (Math.floor(Math.random() * 10) - 3) - b5;
                        equation = `${a5}x - ${b5} = ${c5}`;
                        solution = (c5 + b5) / a5;
                    }
                    break;
                    
                case 4:
                    // Mistura do antigo n√≠vel 6, 7 e 8
                    const type4 = Math.floor(Math.random() * 3);
                    if (type4 === 0) {
                        // a = x + b
                        let a6 = Math.floor(Math.random() * 15) - 2;
                        let b6 = Math.floor(Math.random() * 10) + 1;
                        equation = `${a6} = x + ${b6}`;
                        solution = a6 - b6;
                    } else if (type4 === 1) {
                        // -a*x = b
                        let a7 = Math.floor(Math.random() * 5) + 2;
                        let b7 = a7 * (Math.floor(Math.random() * 10) - 3);
                        equation = `-${a7}x = ${b7}`;
                        solution = -b7 / a7;
                    } else {
                        // a = b*x - c
                        let a8 = Math.floor(Math.random() * 20) - 5;
                        let b8 = Math.floor(Math.random() * 4) + 2;
                        let c8 = Math.floor(Math.random() * 8) + 1;
                        equation = `${a8} = ${b8}x - ${c8}`;
                        solution = (a8 + c8) / b8;
                    }
                    break;
                    
                case 5:
                    // Mistura do antigo n√≠vel 9 e 10
                    if (Math.random() > 0.5) {
                        // (1/a)*x = b
                        let a9 = Math.floor(Math.random() * 4) + 2;
                        let b9 = Math.floor(Math.random() * 10) - 3;
                        equation = `(1/${a9})x = ${b9}`;
                        solution = b9 * a9;
                    } else {
                        // 0.a*x = b
                        let a10 = (Math.floor(Math.random() * 9) + 1) / 10;
                        let b10 = Math.floor(Math.random() * 8) - 2;
                        equation = `${a10.toFixed(1)}x = ${b10}`;
                        solution = Math.round((b10 / a10) * 10) / 10;
                    }
                    break;
                    
                case 6:
                    // Mistura do antigo n√≠vel 11 e 12
                    if (Math.random() > 0.5) {
                        // a*x + b = c*x + d
                        let a11 = Math.floor(Math.random() * 5) + 2;
                        let b11 = Math.floor(Math.random() * 5) + 1;
                        let c11 = Math.floor(Math.random() * 4) + 1;
                        let d11 = Math.floor(Math.random() * 5) + 1;
                        equation = `${a11}x + ${b11} = ${c11}x + ${d11}`;
                        solution = (d11 - b11) / (a11 - c11);
                    } else {
                        // a*x - b = -c*x + d
                        let a12 = Math.floor(Math.random() * 5) + 2;
                        let b12 = Math.floor(Math.random() * 5) + 1;
                        let c12 = Math.floor(Math.random() * 4) + 1;
                        let d12 = Math.floor(Math.random() * 5) + 1;
                        equation = `${a12}x - ${b12} = -${c12}x + ${d12}`;
                        solution = (d12 + b12) / (a12 + c12);
                    }
                    break;
                    
                case 7:
                    // Mistura do antigo n√≠vel 13 e 14
                    if (Math.random() > 0.5) {
                        // a*(x + b) = c
                        let a13 = Math.floor(Math.random() * 5) + 2;
                        let b13 = Math.floor(Math.random() * 5) + 1;
                        let c13 = a13 * (Math.floor(Math.random() * 5) + b13 + 1);
                        equation = `${a13}(x + ${b13}) = ${c13}`;
                        solution = (c13 / a13) - b13;
                    } else {
                        // a*(x - b) = c*(x + d)
                        let a14 = Math.floor(Math.random() * 4) + 2;
                        let b14 = Math.floor(Math.random() * 3) + 1;
                        let c14 = Math.floor(Math.random() * 3) + 1;
                        let d14 = Math.floor(Math.random() * 3) + 1;
                        equation = `${a14}(x - ${b14}) = ${c14}(x + ${d14})`;
                        solution = (a14 * b14 + c14 * d14) / (a14 - c14);
                    }
                    break;
                    
                case 8:
                    // Mistura do antigo n√≠vel 15, 16 e 17
                    const type8 = Math.floor(Math.random() * 3);
                    if (type8 === 0) {
                        // x/a + x/b = c
                        let a15 = Math.floor(Math.random() * 4) + 2;
                        let b15 = Math.floor(Math.random() * 4) + 2;
                        let c15 = Math.floor(Math.random() * 5) + 1;
                        equation = `x/${a15} + x/${b15} = ${c15}`;
                        solution = (c15 * a15 * b15) / (b15 + a15);
                    } else if (type8 === 1) {
                        // 0.a*x + 0.b = c
                        let a16 = (Math.floor(Math.random() * 9) + 1) / 10;
                        let b16 = (Math.floor(Math.random() * 9) + 1) / 10;
                        let c16 = Math.floor(Math.random() * 3) + 1;
                        equation = `${a16.toFixed(1)}x + ${b16.toFixed(1)} = ${c16}`;
                        solution = Math.round(((c16 - b16) / a16) * 10) / 10;
                    } else {
                        // (a*x)/b + c = x - d
                        let a17 = Math.floor(Math.random() * 4) + 2;
                        let b17 = Math.floor(Math.random() * 4) + 2;
                        let c17 = Math.floor(Math.random() * 3) + 1;
                        let d17 = Math.floor(Math.random() * 3) + 1;
                        equation = `(${a17}x)/${b17} + ${c17} = x - ${d17}`;
                        solution = (b17 * (c17 + d17)) / (b17 - a17);
                    }
                    break;
                    
                case 9:
                    // Mistura do antigo n√≠vel 18, 19 e 20
                    const type9 = Math.floor(Math.random() * 3);
                    if (type9 === 0) {
                        // a*(b*x - c) + d*(x + e) = f
                        let a18 = Math.floor(Math.random() * 3) + 2;
                        let b18 = Math.floor(Math.random() * 3) + 1;
                        let c18 = Math.floor(Math.random() * 3) + 1;
                        let d18 = Math.floor(Math.random() * 3) + 1;
                        let e18 = Math.floor(Math.random() * 3) + 1;
                        let f18 = a18 * (b18 * (Math.floor(Math.random() * 3) + 2) - c18) + d18 * ((Math.floor(Math.random() * 3) + 2) + e18);
                        equation = `${a18}(${b18}x - ${c18}) + ${d18}(x + ${e18}) = ${f18}`;
                        solution = (f18 + a18 * c18 - d18 * e18) / (a18 * b18 + d18);
                    } else if (type9 === 1) {
                        // (a*(x - b))/c = (x + d)/e
                        let a19 = Math.floor(Math.random() * 3) + 2;
                        let b19 = Math.floor(Math.random() * 3) + 1;
                        let c19 = Math.floor(Math.random() * 3) + 2;
                        let d19 = Math.floor(Math.random() * 3) + 1;
                        let e19 = Math.floor(Math.random() * 3) + 2;
                        equation = `(${a19}(x - ${b19}))/${c19} = (x + ${d19})/${e19}`;
                        solution = (a19 * b19 * e19 + c19 * d19) / (a19 * e19 - c19);
                    } else {
                        // 0.a*(b*x - c) + (1/d)*(x + e) = f*x - g
                        let a20 = (Math.floor(Math.random() * 5) + 1) / 10;
                        let b20 = Math.floor(Math.random() * 3) + 2;
                        let c20 = Math.floor(Math.random() * 3) + 1;
                        let d20 = Math.floor(Math.random() * 3) + 2;
                        let e20 = Math.floor(Math.random() * 3) + 1;
                        let f20 = Math.floor(Math.random() * 2) + 1;
                        let g20 = Math.floor(Math.random() * 3) + 1;
                        equation = `${a20.toFixed(1)}(${b20}x - ${c20}) + (1/${d20})(x + ${e20}) = ${f20}x - ${g20}`;
                        solution = (a20 * c20 - e20/d20 - g20) / (a20 * b20 + 1/d20 - f20);
                    }
                    break;
                    
                case 10:
                    // Desafio final - Todas as complexidades
                    const type10 = Math.floor(Math.random() * 4);
                    // Equa√ß√µes complexas de todos os tipos anteriores
                    // (implementa√ß√£o similar aos casos anteriores, mas mais desafiadoras)
                    let baseA = Math.floor(Math.random() * 5) + 2;
                    let baseB = Math.floor(Math.random() * 10) - 2;
                    equation = `${baseA}x + ${baseB} = ${baseA * 2 + baseB}`;
                    solution = 2;
                    break;
            }
            
            currentEquation = equation;
            correctAnswer = solution;
            
            elements.equationDisplay.textContent = equation;
            generateOptions();
        }


        function generateOptions() {
            elements.optionsContainer.innerHTML = '';
            
            let options = [correctAnswer];
            
            // Verificar se a resposta √© um n√∫mero inteiro
            const isInteger = Number.isInteger(correctAnswer);
            
            // Definir o range baseado no n√≠vel e se √© inteiro
            let range;
            if (isInteger) {
                // Para n√∫meros inteiros, usar range baseado no valor absoluto
                range = Math.max(2, Math.floor(Math.abs(correctAnswer) * 0.4) + 3);
            } else {
                // Para n√∫meros decimais, usar range menor
                range = Math.max(1, Math.abs(correctAnswer) * 0.3);
            }
            
            // Ajustar range para n√≠veis mais altos (respostas podem ser maiores)
            if (currentLevel >= 15) {
                range *= 1.5;
            } else if (currentLevel >= 10) {
                range *= 1.2;
            }
            
            while (options.length < 6) {
                let option;
                let attempts = 0;
                
                do {
                    // Gerar varia√ß√£o que pode ser positiva ou negativa
                    const variation = (Math.random() * (range * 2) - range);
                    
                    if (isInteger) {
                        // Para respostas inteiras, gerar apenas op√ß√µes inteiras
                        option = correctAnswer + Math.round(variation);
                        // Garantir que n√£o seja zero quando a resposta n√£o √© zero
                        if (option === 0 && correctAnswer !== 0) {
                            option = correctAnswer + (Math.random() > 0.5 ? 1 : -1);
                        }
                    } else {
                        // Para respostas decimais, manter uma casa decimal
                        option = correctAnswer + variation;
                        option = Math.round(option * 10) / 10;
                    }
                    
                    attempts++;
                    
                    if (attempts > 30) {
                        // Se n√£o conseguir gerar op√ß√µes √∫nicas, criar manualmente
                        if (isInteger) {
                            option = correctAnswer + (options.length * 2 - 5);
                        } else {
                            option = correctAnswer + (options.length * 0.5 - 1.5);
                            option = Math.round(option * 10) / 10;
                        }
                        break;
                    }
                } while (options.includes(option) || option === correctAnswer);
                
                if (option !== correctAnswer && !options.includes(option)) {
                    options.push(option);
                }
            }
            
            shuffleArray(options).forEach(option => {
                const button = document.createElement('button');
                button.className = 'option';
                button.textContent = option;
                elements.optionsContainer.appendChild(button);
            });
        }
            

      function checkAnswer(answer) {
            if (!gameActive) return;
            
            desabilitarOpcoes(elements.optionsContainer);
            
            // Verificar se a resposta est√° correta (com margem de erro para n√∫meros decimais)
            const isCorrect = Math.abs(answer - correctAnswer) < 0.01;
            
            if (isCorrect) {
                score++;
                remainingEquations--;
                elements.scoreElement.textContent = `${score}/${totalQuestions}`;
                
                // ACR√âSCIMO DE TEMPO: 3s para todos os n√≠veis
                remainingTime += 3;
                
                // Resetar contador de erros quando acerta
                errorCount = 0;
            } else {
                // PENALIDADE ESCALONADA: primeiro erro 2s, multiplica por 2 a cada erro
                const penalty = 2 * Math.pow(2, errorCount);
                remainingTime = Math.max(0.1, remainingTime - penalty);
                errorCount++; // Incrementar contador de erros
            }
            
            elements.deck.querySelector('div').textContent = remainingEquations;
            
            // Arredondar tempo
            remainingTime = Math.round(remainingTime * 10) / 10;
            
            updateTimeDisplay();
            atualizarTimerVisual((remainingTime / timeLimit) * 100);
            
            // Verificar condi√ß√µes de t√©rmino
            if (score >= totalQuestions) {
                setTimeout(() => {
                    limparTimer();
                    endGame();
                }, 800);
                return;
            }
            
            if (remainingEquations <= 0) {
                setTimeout(() => {
                    limparTimer();
                    endGame();
                }, 800);
                return;
            }
            
            if (remainingTime <= 0.1) {
                setTimeout(() => {
                    limparTimer();
                    endGame();
                }, 800);
                return;
            }
            
            // Continuar o jogo
            setTimeout(() => {
                if (gameActive) {
                    generateEquation();
                }
            }, 800);
        }

        function desabilitarOpcoes(container) {
            container.querySelectorAll('.option').forEach(button => {
                button.disabled = true;
                button.style.opacity = '0.6';
                button.style.cursor = 'not-allowed';
            });
        }

        function endGame() {
            gameActive = false;
            limparTimer();
            
            elements.gameScreen.classList.add('hidden');
            elements.resultScreen.classList.remove('hidden');
            if (elements.restartBtn) elements.restartBtn.classList.add('hidden');
            
            const venceu = score >= totalQuestions;
            const tempoEsgotado = remainingTime <= 0.1;
            
            if (venceu) {
                elements.resultMessage.textContent = 'Parab√©ns!';
                elements.resultMessage.classList.remove('lose');
                elements.resultStats.textContent = `Voc√™ acertou ${score} de ${totalQuestions} equa√ß√µes!`;
            } else if (tempoEsgotado) {
                elements.resultMessage.textContent = 'Tempo esgotado!';
                elements.resultMessage.classList.add('lose');
                elements.resultStats.textContent = `Voc√™ acertou ${score} de ${totalQuestions} equa√ß√µes.`;
            } else {
                elements.resultMessage.textContent = 'Fim do jogo!';
                elements.resultMessage.classList.add('lose');
                elements.resultStats.textContent = `Voc√™ acertou ${score} de ${totalQuestions} equa√ß√µes.`;
            }
            
            if (elements.nextLevelBtn) {
                elements.nextLevelBtn.style.display = venceu && currentLevel < 20 ? 'block' : 'none';
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Inicializar o jogo quando a p√°gina carregar
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
