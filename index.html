<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jogo de Associação - História</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Tela de Seleção de Ano -->
<div id="year-selection">
    <h1>JOGO DE ASSOCIAÇÃO HISTÓRICA</h1>
    <p>ESCOLHA O ANO PARA JOGAR:</p>
    <button class="year-btn" data-year="6">6º ANO</button>
    <button class="year-btn" data-year="7">7º ANO</button>
    <button class="year-btn" data-year="8">8º ANO</button>
    <button class="year-btn" data-year="9">9º ANO</button>
</div>

<!-- Tela de Instruções -->
<div id="start-screen">
    <h1>JOGO DE ASSOCIAÇÃO</h1>
    <p>COMBINE AS CARTAS. VOCÊ TEM 3 VIDAS.</p>
    <p>INSTRUÇÕES:</p>
    <p>1º Clique na carta. Clique no espaço abaixo das cartas.</p>
    <p>2º Faça o mesmo com a carta que se associa a primeira.</p>
    <p>Aqui é só um treino. Se você conseguir me mostrar o game concluído durante a aula receberá 3 pontos na média como prêmio.</p>
    
    <h3>ESCOLHA A DIFICULDADE:</h3>
    <button class="difficulty-btn" data-difficulty="easy">Modo Fácil</button>
    <button class="difficulty-btn" data-difficulty="hard">Modo Difícil</button>
    
    <button id="start-button">Iniciar Jogo</button>
</div>

<!-- Tela do Jogo -->
<div id="game-screen">
    <h2 id="game-title">PREPARADO?</h2>
    <div id="timer" style="font-size: 18px; margin: 10px;">Tempo: 00:00</div>
    <div class="lives" id="lives-container">
        <div class="life"></div>
        <div class="life"></div>
        <div class="life"></div>
    </div>
    <div class="drag-area" id="drag-container">
        <!-- Itens para selecionar -->
    </div>
    
    <div class="drop-area" id="drop-container">
        <!-- Pares de dominó -->
    </div>
	<button id="back-button" style="background-color: #f44336; margin-top: 20px;">Voltar para Anos</button>
</div>

<!-- Tela de Resultado -->
<div id="result-screen">
    <h2 id="result-message"></h2>
    <button id="restart-button">Jogar Novamente</button>
    <button id="back-to-years">Voltar para Anos</button>
</div>


<script type="module">

 import gameData from "./dados.js?version=1"

    // Dados do jogo por ano (você pode preencher isso depois)
    // Elementos do DOM
    const yearSelection = document.getElementById('year-selection');
    const startScreen = document.getElementById('start-screen');
    const gameScreen = document.getElementById('game-screen');
    const resultScreen = document.getElementById('result-screen');
    const resultMessage = document.getElementById('result-message');
    const gameTitle = document.getElementById('game-title');
    const dragContainer = document.getElementById('drag-container');
    const dropContainer = document.getElementById('drop-container');
    const livesContainer = document.getElementById('lives-container');
    const startButton = document.getElementById('start-button');
    const restartButton = document.getElementById('restart-button');
    const backToYearsButton = document.getElementById('back-to-years');
    const yearButtons = document.querySelectorAll('.year-btn');
    const backButton = document.getElementById('back-button');
    const difficultyButtons = document.querySelectorAll('.difficulty-btn');
  

    // Variáveis do jogo
    let selectedItem = null;
    let dropSlots = [];
    let lives = 3;
    let correctPairs = 0;
    let currentYear = "";
    let currentPairs = [];
    let startTime;
    let timerInterval;
    let elapsedTime = 0;
    let currentDifficulty = "hard"; // Padrão: modo difícil


    // Selecionar ano
    yearButtons.forEach(button => {
        button.addEventListener('click', () => {
            currentYear = button.dataset.year;
            const yearData = gameData[currentYear];
            
            if (yearData) {
                currentPairs = yearData.pairs;
                gameTitle.textContent = yearData.title;
                
                yearSelection.style.display = 'none';
                startScreen.style.display = 'block';
            }
        });
    });

    // Selecionar dificuldade
    difficultyButtons.forEach(button => {
        button.addEventListener('click', () => {
            currentDifficulty = button.dataset.difficulty;
            
            // Destacar o botão selecionado
            difficultyButtons.forEach(btn => {
                btn.style.opacity = btn === button ? "1" : "0.7";
            });
        });
    });

    // Iniciar o jogo
    startButton.addEventListener('click', () => {
        startScreen.style.display = 'none';
        gameScreen.style.display = 'block';
        resetGame();
        setupGame();
    });

    // Reiniciar o jogo
    restartButton.addEventListener('click', () => {
        resultScreen.style.display = 'none';
        gameScreen.style.display = 'block';
        resetGame();
        setupGame();
    });

    // Voltar para seleção de anos
    backToYearsButton.addEventListener('click', () => {
        resultScreen.style.display = 'none';
        yearSelection.style.display = 'block';
    });

    backButton.addEventListener('click', () => {
        gameScreen.style.display = 'none';
        yearSelection.style.display = 'block';
    });

    // Função para iniciar o cronômetro
    function startTimer() {
        startTime = Date.now() - elapsedTime;
        timerInterval = setInterval(updateTimer, 1000);
    }

    // Função para atualizar o cronômetro
    function updateTimer() {
        elapsedTime = Date.now() - startTime;
        const seconds = Math.floor((elapsedTime / 1000) % 60);
        const minutes = Math.floor((elapsedTime / 1000 / 60) % 60);
        document.getElementById('timer').textContent = `Tempo: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // Função para parar o cronômetro
    function stopTimer() {
        clearInterval(timerInterval);
    }

    // Função para resetar o cronômetro
    function resetTimer() {
        stopTimer();
        elapsedTime = 0;
        document.getElementById('timer').textContent = 'Tempo: 00:00';
    }

    function resetGame() {
        lives = 3;
        correctPairs = 0;
        updateLivesDisplay();
    }

    function updateLivesDisplay() {
        const lifeElements = document.querySelectorAll('.life');
        lifeElements.forEach((life, index) => {
            life.classList.toggle('lost', index >= lives);
        });
    }

    function loseLife() {
        lives--;
        updateLivesDisplay();
        
        if (lives <= 0) {
            endGame(false);
        }
    }

    function endGame(success) {
        stopTimer();
    
        gameScreen.style.display = 'none';
        resultScreen.style.display = 'block';
        
        if (success) {
            // Calcular o tempo decorrido formatado
            const seconds = Math.floor((elapsedTime / 1000) % 60);
            const minutes = Math.floor((elapsedTime / 1000 / 60) % 60);
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Mensagem com o ano e tempo
            resultMessage.textContent = `Parabéns! Você completou a tarefa do ${currentYear}º ano em ${timeString}!`;
        } else {
            resultMessage.textContent = "Tente novamente! Você errou 3 vezes.";
        }
    }

    // Configurar o jogo
    function setupGame() {
        dragContainer.innerHTML = '';
        dropContainer.innerHTML = '';
        selectedItem = null;
        dropSlots = [];

        // Criar lista com todos os itens
        let allItems = [];
        currentPairs.forEach(pair => {
            allItems.push(
                { id: pair.id * 2, content: pair.itemA, type: pair.typeA, pairId: pair.id, theme: pair.theme },
                { id: pair.id * 2 + 1, content: pair.itemB, type: pair.typeB, pairId: pair.id, theme: pair.theme }
            );
        });

        // Embaralhar
        allItems = shuffleArray(allItems);

        // Adicionar itens arrastáveis
        allItems.forEach(item => {
            const dragItem = document.createElement('div');
            dragItem.className = 'drag-item';
            dragItem.dataset.id = item.id;
            dragItem.dataset.pairId = item.pairId;
            
            // Aplicar cor de tema se estiver no modo fácil
            if (currentDifficulty === "easy" && item.theme !== undefined) {
                const themeClass = `theme-color-${item.theme % 6}`; // Usamos módulo 6 para garantir que temos uma classe válida
                dragItem.classList.add(themeClass);
            }

            if (item.type === "image") {
                const img = document.createElement('img');
                img.src = item.content;
                dragItem.appendChild(img);
            } else {
                dragItem.textContent = item.content;
            }

            dragItem.addEventListener('click', () => selectItem(dragItem));
            dragContainer.appendChild(dragItem);
        });

        // Criar slots (metade do número de pares)
        for (let i = 0; i < 4; i++) {
            const dominoPair = document.createElement('div');
            dominoPair.className = 'domino-pair';

            const dropSlot1 = document.createElement('div');
            dropSlot1.className = 'drop-slot';
            dropSlot1.dataset.pairIndex = i;

            const dropSlot2 = document.createElement('div');
            dropSlot2.className = 'drop-slot';
            dropSlot2.dataset.pairIndex = i;

            [dropSlot1, dropSlot2].forEach(slot => {
                slot.addEventListener('click', () => tryPlaceItem(slot));
                dropSlots.push(slot);
            });

            dominoPair.appendChild(dropSlot1);
            dominoPair.appendChild(dropSlot2);
            dropContainer.appendChild(dominoPair);
        }
        
        resetTimer();
        startTimer();
    }
    
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function selectItem(item) {
        // Desselecionar item anterior
        document.querySelectorAll('.drag-item.selected').forEach(el => {
            el.classList.remove('selected');
        });
        
        // Selecionar novo item
        selectedItem = item;
        item.classList.add('selected');
        
        // Mostrar slots disponíveis
        dropSlots.forEach(slot => {
            if (!slot.hasChildNodes()) {
                slot.classList.add('highlight');
            }
        });
    }

    function tryPlaceItem(slot) {
        if (!selectedItem || slot.hasChildNodes()) return;

        // Remover highlight
        dropSlots.forEach(s => s.classList.remove('highlight'));

        // Criar cópia do item
        const clonedItem = selectedItem.cloneNode(true);
        clonedItem.classList.remove('selected');
        clonedItem.addEventListener('click', (e) => {
            e.stopPropagation();
            dragContainer.appendChild(clonedItem);
            clonedItem.addEventListener('click', () => selectItem(clonedItem));
        });

        // Colocar no slot
        slot.appendChild(clonedItem);
        
        // Remover original
        selectedItem.remove();
        selectedItem = null;

        // Verificar se completou um par
        checkPairs();
    }

    function checkPairs() {
        // Verificar todos os pares de slots
        for (let i = 0; i < dropSlots.length; i += 2) {
            const slot1 = dropSlots[i];
            const slot2 = dropSlots[i + 1];

            // Se ambos slots estão preenchidos
            if (slot1.firstChild && slot2.firstChild) {
                const item1 = slot1.firstChild;
                const item2 = slot2.firstChild;

                // Verificar se é um par correto
                if (item1.dataset.pairId === item2.dataset.pairId) {
                    // Par correto - remover após 0.5s
                    setTimeout(() => {
                        slot1.removeChild(item1);
                        slot2.removeChild(item2);
                        correctPairs++;
                        
                        // Verificar vitória
                        if (correctPairs >= currentPairs.length) {
                            endGame(true);
                        }
                    }, 500);
                } else {
                    // Par errado - perder vida após 1s
                    setTimeout(() => {
                        dragContainer.appendChild(item1);
                        dragContainer.appendChild(item2);
                        item1.addEventListener('click', () => selectItem(item1));
                        item2.addEventListener('click', () => selectItem(item2));
                        loseLife();
                    }, 1000);
                }
            }
        }
    }
</script>
</body>
</html>